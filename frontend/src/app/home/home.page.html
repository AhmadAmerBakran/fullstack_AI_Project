<ion-header>
  <ion-toolbar>
    <div class="flex-spacer"></div>
    <ion-title>Welcome To Anonymous Wall</ion-title>
    <div class="flex-spacer"></div>
  </ion-toolbar>
</ion-header>

<ion-content style="--background: no-repeat center/cover url('/assets/images/background.jpg');">
  <div class="posts-container">
    <ion-list style="background-color: transparent">
      <ion-card style="margin: 50px; padding: 25px; border-radius: 15px" *ngFor="let post of posts">
        <ion-card-header>
        <ion-item lines="none">
          <ion-icon style="font-size: 50px" name="person-circle" slot="start"></ion-icon>
          <ion-label>
            <strong>Posted by: Anonymous </strong>
            <p>{{ post.publishDate | timeAgo }}</p>
            <h1>{{ post.title }}</h1>
          </ion-label>
          <ion-button (click)="presentTranslateModal(post.content, post.id, true)" fill="clear" color="secondary" >
            <ion-icon slot="icon-only" name="language-outline"></ion-icon>
          </ion-button>
          <ion-button fill="clear" color="secondary" (click)="playPostAudio(post.id)" >
            <ion-icon slot="icon-only" name="volume-high-outline"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-card-header>

      <ion-card-content>
        <div class="post-content">
          <h1>{{post.content}}</h1>
        </div>
        <ion-img [src]="post.postImage" *ngIf="post.postImage"></ion-img>
      </ion-card-content>

      <ion-row>
        <ion-col size="auto">
          <ion-button (click)="loadComments(post.id)" fill="clear" color="primary">
            <ion-icon slot="icon-only" name="chatbubble-outline"></ion-icon>
            <ion-badge *ngIf="post.commentCount >= 0">{{ post.commentCount }} comments</ion-badge>
          </ion-button>
        </ion-col>
      </ion-row>

      <!-- Comments Section -->
      <div *ngIf="comments.length > 0 && comments[0].postId === post.id">
        <ion-list>
          <ion-item *ngFor="let comment of comments">
            <ion-avatar slot="start">
              <ion-icon style="font-size: 25px" name="person-circle"></ion-icon>
            </ion-avatar>
            <ion-label>
              <h3> Anonymous Person </h3>
              <p>{{ comment.commentDate | timeAgo }}</p>
              <p>{{ comment.content }}</p>
            </ion-label>
            <ion-button (click)="presentTranslateModal(comment.content, comment.id, false)" fill="clear" color="secondary" >
              <ion-icon slot="icon-only" name="language-outline"></ion-icon>
            </ion-button>
            <ion-button fill="clear" color="secondary" (click)="playCommentAudio(comment.id)">
              <ion-icon slot="icon-only" name="volume-high-outline"></ion-icon>
            </ion-button>
          </ion-item>
        </ion-list>
      </div>
        <form [formGroup]="commentForms[post.id]" (ngSubmit)="submitComment(post.id)">
          <ion-item>
            <ion-input type="text" formControlName="content" placeholder="Write a comment..."></ion-input>
          </ion-item>
          <ion-item>
            <ion-label>Language</ion-label>
            <ion-select formControlName="language" placeholder="Select Language">
              <ion-select-option *ngFor="let lang of languages" [value]="lang.code">{{ lang.name }}</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-button type="submit">Comment</ion-button>
        </form>
      </ion-card>
    </ion-list>
  </div>
  <router-outlet></router-outlet>
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="presentCreatePostModal()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
